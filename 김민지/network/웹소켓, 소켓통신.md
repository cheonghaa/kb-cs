# 웹 소켓과 소켓 통신

<br/>

## 소켓(Socket)

<img width="600" src="https://images.velog.io/images/cha-suyeon/post/449bc535-013a-4931-929e-e8856d02b688/image.png">

- 네트워크를 통해 통신하는 프로세스 간의 인터페이스를 제공하는 소프트웨어 구조로, 주로 클라이언트와 서버 간의 데이터 전송을 관리하는 데 사용
- 기본 개념
  - `네트워크 통신의 엔드포인트`
    - 소켓은 네트워크 통신을 위한 엔드포인트를 제공함. 즉, 소켓은 네트워크 상에서 두 프로세스 간의 통신을 설정하고 관리하는 객체임
    - 클라이언트 소켓과 서버 소켓이 있으며, 클라이언트 소켓은 서버에 연결을 요청하고, 서버 소켓은 클라이언트의 연결 요청을 수신함
  - `소켓의 구성`
    - IP 주소,  Port 번호
    - 프로토콜 : 데이터 전송 방식. 주요 프로토콜로는 TCP(전송 제어 프로토콜)와 UDP(사용자 데이터그램 프로토콜)가 있음
  - `소켓의 동작 원리`
    - 서버 소켓 : 네트워크 포트를 열어 클라이언트의 연결 요청을 대기함. 연결 요청이 오면, 새 소켓을 생성하여 클라이언트와 통신함.
    - 클라이언트 소켓: 서버 소켓에 연결 요청을 보내고, 연결이 수립되면 서버와 데이터를 송수신함.
- 역할
    - 소프트웨어와 소프트웨어를 연결(IP와 포트 이용)
    - 소프트웨어간 데이터 통신(소켓)

- `Endpoint`: IP 주소와 Port 번호의 조합으로, 최종 목적지 역할

    <img src="https://hanamon.kr/wp-content/uploads/2021/09/IP-Port.jpg" width="400">
  
    - IP 주소
        - 전 세계 컴퓨터에 부여된 고유 식별 주소
        - 네트워크 상의 호스트를 식별하는 주소
    - Port 번호
        - 컴퓨터는 다양한 응용 프로그램들은 프로세스 단위로 실행
        - 따라서 응용 프로그램(프로세스)을 식별하기 위해 사용 되는 값
        - 네트워크를 통해 데이터를 주고받을 때, 어떤 프로세스가 어떤 프로세스에게 보내는 데이터인지 확인하는 용도
- 특징
    - TCP/UDP에서 동작하기 때문에, 서버-클라이언트 통신 구조를 갖춤
    - 소켓은 양쪽에서 실시간으로 데이터를 송수신할 수 있는 양방향 통신(실시간 스트리밍, 채팅)
    - 네트워크 프로그래밍 인터페이스이기 때문에, 프로그래밍 언어나 운영체제마다 다를 수 있어 종속적임
- 종류
    - TCP/IP 프로토콜 기반의 `Stream 소켓`
        - TCP를 사용하는 소켓으로, 신뢰성 있는 연결 지향적 통신을 제공함.
        - 데이터가 순서대로 전송되며, 손실된 데이터는 자동으로 재전송됨. 
        - 예: 웹 브라우저와 웹 서버 간의 통신.
    - UDP/IP 프로토콜 기반의 `Datagram 소켓`
        - UDP를 사용하는 소켓으로, 비연결 지향적 통신을 제공함. 
        - 데이터의 순서나 신뢰성 보장을 하지 않으며, 빠른 데이터 전송이 필요할 때 사용됨. 
        - 예: 실시간 비디오 스트리밍, 온라인 게임.


<br/>

### 소켓 통신


- 서버와 클라이언트의 각 프로세스가 실시간으로 양방향 통신을 하는 방식
    - 소켓은 데이터를 통신할 수 있도록 연결해주기 때문에 통신할 클라이언트와 서버 모두 소켓이 생성되어야 함
- 프로세스는 각각 고유한 Port 번호를 가지고 있으며, 여러 개의 소켓을 가질 수 있음
    - `IP 주소(도착지 정보)`, `프로토콜 정보`, `Port 번호(프로세스 정보)` 등
    - 소켓은 생성될 소켓의 종류를 결정하여 프로세스에 맞게 생성되었다가 통신이 종료되면 삭제됨
        - 소켓 주소: `IP 주소: 서비스 포트` 형태로 사용, `192.168.1.10:23`
    - 하나의 프로세스는 동일한 Port 번호를 가진 여러 개의 Socket을 만들어 다른 호스트와 데이터를 주고받을 수 있음

<img width="500" src="https://images.velog.io/images/emplam27/post/e59ca1ba-ca77-4903-addd-c6590ba0600d/%EC%86%8C%EC%BC%93%20%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4.jpg" >

- 통신 과정

    1. 서버의 각 프로세스는 기본적으로 연결 요청을 듣고 있는 하나의 소켓(`Listen`)을 소유
        - `Listen` 소켓은 클라이언트의 요청을 기다리는 소켓
    2. 클라이언트(`127.0.0.1`)의 `8000`번 포트를 사용하는 프로세스에서 TCP 통신을 위해 소켓을 생성함
    3. 생성된 소켓에서 서버(`127.0.0.2`)의 `80`번 포트로 네트워크 **연결 요청**
    4. 서버에 기본적으로 존재하던 소켓이 요청을 받아, 조건 확인 후 본인을 복제한 새로운 소켓을 생성
    5. 새로 만들어진 서버의 소켓과 클라이언트의 소켓의 **연결 성공**
    6. 클라이언트와 서버의 **데이터 송수신**이 이루어짐
    7. 클라이언트와 서버간의 네트워크 **연결 종료** 후에는 통신을 위해 만들어진 소켓들은 모두 소멸함


<br/>


## 웹 소켓(Web Socket)

- 개념
    - 웹 페이지의 한계에서 벗어나 실시간 상호작용 웹 서비스를 만드는 표준 기술
    - HTTP를 기반으로 양방향 통신을 제공하는 프로토콜
- 배경
    - HTTP 프로토콜은 클라이언트에서 서버로 단방향 통신을 위해 만들어진 방법
        - 요청을 보내면 응답이 오는 단방향 구조로 통신하며 비연결성
        - TCP/IP 프로토콜을 사용하는 소켓처럼 연결이 유지되는 실시간 통신이 불가능함
    - 실시간 웹을 구현하기 위해서는 양방향 통신이 가능해야 함
        - 웹 소켓 이전에는 Polling, Streaming 방식 등을 이용하여 이를 구현함
            - Polling: 일정한 주기로 서버에 요청을 보내는 방법
            - Streaming: 이벤트가 발생했을 때, 응답을 보내지만 응답을 완료시키지 않고 계속 연결을 유지하는 방식
        - 이 방법들은 각 브라우저마다 구현 방법이 달라 개발이 어려움
    - 문제점을 해결하기 위해 HTML5 표준의 일부로 `Web Socket`이 만들어지게 됨
- 특징
    - HTTP나 HTTPS 위에서 동작하도록 설계됨(포트는 각각 80, 443)
    - 소켓을 이용하여 자유롭게 데이터를 주고받을 수 있음(양방향 통신)
    - 기존의 요청-응답 관계 방식보다 더 쉽게 데이터를 교환할 수 있음
    - 다른 HTTP Request와 마찬가지로 80포트를 통해 웹 서버에 연결함
- 장점
    - HTTP Request를 그대로 사용하기 때문에 기존의 80, 443포트로 접속을 하므로, 추가로 방화벽을 열지 않고도 양방향 통신이 가능함
    - HTTP 규격인 CORS 적용이나 인증 등의 과정을 기존과 동일하게 사용할 수 있음


<br/>

## TCP/IP 소켓 vs 웹소켓
- 공통점
    - IP와 Port를 통해 통신함
    - 양방향 통신
- 차이점
    - 동작 계층(OSI 7계층 기준)
        - 소켓은 인터넷 프로토콜에 기반하므로 TCP, UDP가 속한 4계층(전송 계층)에 위치
        - 웹 소켓은 TCP에 의존하지만 HTTP에 기반하므로 7계층(애플리케이션 계층)에 위치
    - 소켓 통신
        - TCP/IP 소켓(TCP 프로토콜 기반)
            - 3-Way Handshaking 과정으로 연결
            - 4-Way Handshaking 과정으로 연결 종료
        - 웹 소켓
            - 일반 HTTP Request를 통해 HTTP 프로토콜 위에서 Handshaking 과정을 거쳐 최초 접속이 이루어짐
    - 데이터 형식
        - TCP에 기반한 소켓 통신은 단순히 바이트 스트림을 통한 데이터 전송이므로 `바이트로 이루어진 데이터`를 다뤄야 함
        - 웹소켓 통신은 어플리케이션 계층인 7계층에 기반하기 때문에 `메시지 형식의 데이터`를 다룸
    - 추상화 정도
        - TCP/IP 소켓은 저수준 -> 더 많은 제어와 유연성을 제공하지만 더 복잡한 설정과 관리를 요구
        - 웹소켓은 추상화 -> 웹 환경에서 실시간 통신을 손쉽게 구현할 수 있도록 해줌



<br/>
<br/>