# 로드 밸런싱
---

### 1. 로드 밸런싱이란?

애플리케이션을 지원하는 리소스 풀 전체에 네트워크 트래픽을 균등하게 배포하는 방법입니다. 트래픽이 과도하게 몰려 서비스가 중단되는 일을 막고 지연 없이 작업을 처리합니다.

### 2. 로드 밸런서란?

로드 밸런싱을 수행하는 장치로서 로드 밸런서는 **트래픽 과부하 시 다수의 서버로 트래픽을 분산시켜 안정적인 서비스가 유지되도록 하는 서비스**입니다.
로드 밸런서는 상황에 맞게 서버 분산 방식을 적용할 수 있으며, 사용자가 예측하기 어려운 트래픽 과부하나 장애 발생 시 연결된 서버의 정상 작동 여부를 확인(Health Check) 한 후 다른 서버로 트래픽을 우회시켜 서비스의 안정성과 연속성을 보장해 줍니다.
![](https://velog.velcdn.com/images/wxxhyeong/post/ab45dfdd-2076-4991-a531-c1db7ba88ada/image.png)

예를 들면, 로드 밸런서는 주차장의 주차 요원이라고 볼 수 있습니다. 주차장에 사람이 몰릴 경우 주차 요원은 주차장이 마비가 되지 않도록 널널한 곳으로 사람을 안내합니다. 로드 밸런서도 마찬가지로 트래픽이 몰릴 경우 상황에 맞게 트래픽을 다수의 서버로 분산시키는 역할을 합니다.

### 3. 스케일 아웃(Scale Up), 스케일 아웃(Scale Out)
![](https://velog.velcdn.com/images/wxxhyeong/post/c76c0971-37a2-4e92-a3ba-3f39c75366e0/image.png)

- **스케일 업(Scale Up)**

    - 목적: 단일 시스템의 성능을 높여 더 많은 작업을 처리하거나 더 빠른 처리 속도를 제공.
    - 방법: 하드웨어 업그레이드를 통해 시스템의 CPU, 메모리, 스토리지 등을 향상.

    - 예시: 데이터베이스 서버의 메모리와 CPU를 업그레이드하여 더 많은 트랜잭션을 처리.

- **스케일 아웃(Scale Out)**

    - 목적: 여러 시스템을 추가하여 전체 시스템의 용량을 확장하고 부하를 분산.
    - 방법: 네트워크에 더 많은 서버를 추가하고, 작업 부하를 분산 처리.

    - 예시: 웹 애플리케이션 서버를 여러 대 추가하여 들어오는 요청을 로드밸런서를 통해 분산 처리.

**Scale-out** 방식을 통해 증가한 트래픽에 대처하기로 했다면, 여러 대의 서버로 트래픽을 균등하게 분산해주는 **로드 밸런싱**이 반드시 필요하다.
### 로드 밸런싱의 이점
- **애플리케이션 가용성**
  서버 장애 또는 유지 관리로 인해 애플리케이션 가동 중지 시간이 늘어 방문자가 애플리케이션을 사용할 수 없게 될 수 있습니다. 로드 밸런서는 서버 문제를 자동으로 감지하고 클라이언트 트래픽을 사용 가능한 서버로 리다이렉션하여 시스템의 내결함성을 높입니다.

    - 애플리케이션 가동 중지 없이 애플리케이션 서버 유지 관리 또는 업그레이드 실행
    - 백업 사이트에 자동 재해 복구 제공
    - 상태 확인을 수행하고 가동 중지를 유발할 수 있는 문제 방지

- **애플리케이션 확장성**
  로드 밸런서를 사용하여 여러 서버 간에 네트워크 트래픽을 지능적으로 전달할 수 있습니다. 로드 밸런싱이 다음을 수행하므로 애플리케이션에서 수천 개의 클라이언트 요청을 처리할 수 있습니다.

    - 한 서버에서 트래픽 병목 현상 방지
    - 필요한 경우 다른 서버를 추가하거나 제거할 수 있도록 애플리케이션 트래픽을 예측합니다.
    - 안심하고 조정할 수 있도록 시스템에 중복성을 추가합니다.
- **애플리케이션 보안**
  로드 밸런서에는 인터넷 애플리케이션에 또 다른 보안 계층을 추가할 수 있는 보안 기능이 내장되어 있습니다. 이는 공격자가 서버 장애를 일으키는 수백만 개의 동시 요청으로 애플리케이션 서버를 가득 채우는 분산 서비스 거부 공격을 처리하는 데 유용한 도구입니다. 로드 밸런서는 다음을 수행할 수도 있습니다.

    - 트래픽 모니터링 및 악성 콘텐츠 차단
    - 공격 트래픽을 여러 백엔드 서버로 자동으로 리디렉션하여 영향 최소화
    - 추가 보안을 위해 네트워크 방화벽 그룹을 통해 트래픽 라우팅
- **애플리케이션 성능**
  로드 밸런서는 응답 시간을 늘리고 네트워크 지연 시간을 줄여 애플리케이션 성능을 향상시킵니다. 다음과 같은 몇 가지 중요한 태스크를 수행합니다.

    - 서버 간에 로드를 균등하게 배포하여 애플리케이션 성능 향상
    - 클라이언트 요청을 지리적으로 더 가까운 서버로 리디렉션하여 지연 시간 단축
    - 물리적 및 가상 컴퓨팅 리소스의 신뢰성 및 성능 보장

### 4. 로드 밸런싱 알고리즘

#### _정적 로드 밸런싱_
정적 로드 밸런싱 알고리즘은 고정된 규칙을 따르며 현재 서버 상태와 무관합니다.

- <u>**라운드 로빈 방식**</u> : 서버에 들어온 요청을 순서대로 분배하는 방식
  클라이언트의 요청을 순서대로 분배하기 때문에 서버들이 동일 스펙을 가지고 있고, 서버와의 연결(세션)이 오래 지속되지 않는 경우 활용하기 적합하다.

    - A, B, C의 서버를 가지고 있을 경우 A → B → C → A 순서대로 순회합니다.
      <br>
- <u>**가중치 기반 라운드 로빈 방식**</u> : 각각의 서버마다 가중치(Weight)를 매기고 가중치가 높은 서버에 클라이언트의 요청을 먼저 배분합니다. 여러 서버가 같은 사양이 아니고, 특정 서버의 스펙이 더 좋은 경우 해당 서버의 가중치를 높게 매겨 트래픽 처리량을 늘릴 수 있습니다.

    - 서버 A의 가중치=8, 서버 B의 가중치=2, 서버 C의 가중치=3 → 서버 A에 8개, 서버 B에 2개, 서버 C에 3개의 Request를 할당합니다.

- <u>**IP 해시 방식**</u> : IP 해시 방식에서 로드밸런서는 클라이언트 IP 주소에 대해 해싱이라고 하는 수학적인 계산을 수행합니다. 클라이언트 IP 주소를 숫자로 변환한 다음 개별 서버에 매핑합니다. 사용자 IP를 해싱하여 부하를 분산하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장합니다.

#### _동적 로드 밸런싱_
-  **<u>최소 연결 방법(Least Connection Method)</u>**
   최소 연결 방법에서 로드 밸런서는 활성 연결이 가장 적은 서버를 확인하고 해당 서버로 트래픽을 전송합니다. 이 방법에서는 모든 연결에 모든 서버에 대해 동일한 처리 능력이 필요하다고 가정합니다.

- **<u>최소 응답 시간 방법(Least Response Time Method)</u>**
  서버의 현재 연결 상태와 응답 시간을 모두 고려하여, 가장 짧은 응답 시간을 보내는 서버로 트래픽을 할당합니다. 각 서버의 가용 가능한 리소스와 성능, 처리 중인 데이터양 등이 상이할 경우 적합합니다. 조건에 잘 들어맞는 서버가 있을 시 여유 있는 서버보다 먼저 할당됩니다. 로드 밸런서는 이 알고리즘을 사용하여 모든 사용자에게 더 빠른 서비스를 보장합니다.


### 5. L4 로드밸런싱과 L7 로드밸런싱

![](https://velog.velcdn.com/images/wxxhyeong/post/ea1ed317-4f82-461f-a708-d55598e48346/image.png)

![](https://velog.velcdn.com/images/wxxhyeong/post/ec621356-5abd-4e5c-88c8-483bd57e1148/image.png)


**L4 로드 밸런서**

네트워크 계층(IP, IPX)이나 전송 계층(TCP, UDP)의 정보(IP주소, 포트번호, MAC주소, 전송 프로토콜)를 바탕으로 로드를 분산한다.

**L7 로드 밸런서**

애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 **HTTP 헤더, 쿠키 등**과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다.
쉽게 말해 **패킷의 내용을 확인**하고 그 내용에 따라 로드를 **특정 서버에 분배**하는 것이 가능한 것이다. URL에 따라 부하를 분산시키거나, HTTP 헤더의 쿠키 값에 따라 부하를 분산하는 등 클라이언트의 요청을 보다 세분화해 서버에 전달할 수 있다.

![](https://velog.velcdn.com/images/wxxhyeong/post/2824b0da-b4bb-4913-a6f4-fd0671def684/image.png)
상위 계층에서 사용되는 장비는 하위 계층의 장비가 갖고 있는 기능을 모두 갖고 있기 때문에, 상위 계층으로 갈수록 더욱 정교한 로드 밸런싱이 가능합니다.

### 6. DNS Round Robin(대용량 세션을 위한 로드밸런서)
